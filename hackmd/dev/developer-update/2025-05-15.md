# ElizaOS Developer Update (May 15, 2025)

## Core Framework

The ElizaOS team has made significant progress on the v2 architecture, currently in beta testing. Key improvements include:

- **Repository Reorganization**: Plugins have been moved out of the core repository into a dedicated `elizaos-plugins` repository to streamline maintenance and development.
- **Enhanced Architecture**: The transition from v0.x (v1) to v1.x (v2) brings substantial improvements described by developers as "like day and night."
- **Plugin Compatibility Bridge**: Work has been completed to enable plugin sharing between 0.x and 1.x versions, improving cross-version compatibility.
- **Database Improvements**: Fixed PGLite JSON serialization to handle invalid Unicode escape sequences in logs, and resolved critical database migration issues.

```typescript
// Example of the improved database entity relationship handling
// Create agent table with proper references
const sql = `
CREATE TABLE IF NOT EXISTS "agents" (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

CREATE TABLE IF NOT EXISTS "rooms" (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    agent_id UUID REFERENCES "agents"(id) ON DELETE CASCADE,
    name TEXT NOT NULL
);
`;
```

## New Features

### GitHub-Wallet Integration System

A new system for linking GitHub identities with wallet addresses has been proposed with three implementation methods:

```typescript
// Method 1: Hidden comments in profile READMEs
async function verifyProfileReadme(username: string, address: string): Promise<boolean> {
  const readme = await fetchGitHubReadme(username);
  return readme.includes(`<!-- solana-verify: ${address} -->`);
}

// Method 2: GitHub Gist implementation
async function verifyGist(username: string, address: string): Promise<boolean> {
  const gists = await fetchUserGists(username);
  const verificationGist = gists.find(g => g.filename === 'solana-verify.md');
  return verificationGist?.content?.includes(address) || false;
}
```

### DAG Viewer Tool

A new tool for visualizing and designing agent workflows is under development:

- Built using react-flow as the underlying technology
- Supports custom node types and conditional flows
- Will include agent state tracking and debug views
- Planning to add budget constraints and circuit breakers

### RAG Knowledge Improvements 

Semantic text splitting has been implemented for improved RAG knowledge retrieval, allowing agents to better process and reference knowledge files.

## Bug Fixes

Several critical bugs have been resolved in this update:

1. **PGLite JSON Serialization**: Fixed handling of invalid Unicode escape sequences in logs that were causing crashes.
   ```typescript
   // Before: Would crash on invalid Unicode
   JSON.stringify(logEntry);
   
   // After: Safely handles invalid Unicode
   JSON.stringify(logEntry, (_, v) => 
     typeof v === 'string' ? v.replace(/[\u0000-\u001F]/g, '') : v
   );
   ```

2. **Entity Relationship Handling**: Fixed foreign key constraint violation on agent deletion and added proper cascading deletion.

3. **Twitter Integration Issues**: Resolved problems with the Twitter plugin including:
   - Fixed line breaks appearing as raw characters in tweets
   - Corrected the Twitter agent not replying to some target accounts
   - Improved error handling and configurable retry settings

4. **Discord Message Handling**: Fixed the issue of Discord messages randomly disappearing and improved formatting for replies.

## API Changes

### Plugin Architecture Overhaul

The plugin system has been significantly refactored with the following changes:

- New namespacing convention: `plugin-*` modules are for v2/v1.x and `client-*` modules are for v0.x
- Added support for third-party plugin installation from git repositories (both HTTPS and shorthand formats)
- Introduced a plugin specification submodule to standardize plugin development

### Model Provider Refactoring

Model handling in AgentRuntime has been refactored to support:

- Provider selection based on priority settings
- Dynamic model loading based on provider availability
- Custom model configuration through environment variables

```typescript
// Example of new model provider configuration
const modelConfig = {
  providers: ['openai', 'anthropic', 'deepseek', 'together', 'ollama'],
  priority: {
    default: ['openai', 'anthropic'],
    embedding: ['openai'],
    image: ['openai']
  },
  options: {
    openai: {
      defaultModel: 'gpt-4o'
    }
  }
};
```

## Social Media Integrations

### Twitter/X Updates

- Implemented Twitter timeline functionality with improved response handling
- Fixed interaction fetching and reaction implementation 
- Added comprehensive blog tutorial for Twitter agent setup
- Resolved issues with scheduling posts and handling replies without threading

### Farcaster Integration

- Farcaster v2 plugin exists but is currently in testing
- Updates ensure compatibility with the new plugin architecture

### Discord Integration

- Added proper reply functionality to the Discord plugin
- Fixed message formatting issues
- Enhanced message persistence to prevent disappearing messages

```typescript
// Example of extending the Discord plugin with custom functionality
import { DiscordPlugin } from '@elizaos/plugin-discord';

export class MyCustomDiscordPlugin extends DiscordPlugin {
  override async sendMessage(channelId: string, content: string, options: any = {}) {
    // Custom handling before sending
    const processedContent = this.preprocessMessage(content);
    
    // Call parent implementation with processed content
    return super.sendMessage(channelId, processedContent, {
      ...options,
      // Add reply functionality
      reply: options.messageId ? { messageReference: options.messageId } : undefined
    });
  }
  
  private preprocessMessage(content: string): string {
    // Custom preprocessing logic
    return content;
  }
}
```

## Model Provider Updates

### OpenAI Integration

- Added model usage events for embeddings and image description
- Improved response parsing to support custom fields from GPT-4o
- Optimized to use smaller models for faster responses where appropriate

### Anthropic Integration

- Fixed API key error handling issues
- Enhanced response formatting consistency

### Local AI Models

- Improved Ollama integration with better error handling for "Headers Timeout Error"
- Enhanced local model initialization to prevent system stalls after model path validation

## Breaking Changes

As ElizaOS transitions from v1 (0.x) to v2 (1.x), developers should be aware of these breaking changes:

1. **Plugin Repository Migration**: Plugins have been moved from the core repository to `elizaos-plugins`. Update your import paths accordingly.

2. **Plugin Naming Convention**: 
   - Use `@elizaos/plugin-*` for v2/v1.x 
   - Use `@elizaos/client-*` for v0.x

3. **Version Compatibility**: When using the v2-develop branch (1.x), pin dependencies:
   ```json
   {
     "dependencies": {
       "@elizaos/cli": "^1.0.0-beta.51",
       "@elizaos/core": "^1.0.0-beta.51"
     }
   }
   ```

4. **Plugin Extension Pattern**: When extending plugins, extend the base class instead of modifying services:
   ```typescript
   // CORRECT: Extend the plugin class
   export class MyDiscordPlugin extends DiscordPlugin { ... }
   
   // INCORRECT: Don't modify the service directly
   discordService.sendMessage = myCustomFunction;
   ```

5. **Character Definition Changes**: Character files require updates for the new system, especially around knowledge file referencing and RAG functionality.